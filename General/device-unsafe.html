<html>
    <head>
        <title>
            Your iDevice is unsafe
        </title>
    </head>
    <body style="font-family:courier;width:70%">
        <h3>Your iDevice is unsafe</h3>
        <h4><i>Wrote when I was in high school, 06/2013</i></h4>
        
        <p>What is iDevice? The device which runs Apple's iOS is iDevice, such as iPhone, iPad, iPod Touch and Apple TV. Until now, Apple has sold over 400,000,000 iDevices. They became very popular among people in the past 5 years.</p>
        <p>However, while people enjoy the convenience and practicability that iDevices bring to them, they neglect the potential risk of being hacked. The book, <i>Hacking and Securing iOS Application</i>, written by Jonathan Zdziarski, is a key to the iOS security world.</p>
        <p>Without doubt, this book is divided into two parts - Hacking and Securing.</p>
        <p>The first part, which the author focus on, Hacking, firstly introduced the iOS security model on device security, followed by data security, network security and application security. They basically cover major aspects on iOS protection. Meanwhile, the specific measures should be taken are also attached at the end of each part.</p>
        <p>According to the book, every iDevice has two built-in keys, Group Identity(GID) and Unique Identity(UID). The iOS uses DKey, which is based on the two keys above, to encrypt some important data. The EMF! key, a key in the cprotect that encrypts the whole filesystem, which is similar to Digital Rights Management(DRM), which is intended to control the use of digital content and devices after sale.</p>
        <p>A jailbroken iDevice can use many Unix-based tools such asps, lsof, tcpdump and sysctl. Many of them can be used to debug and analyze softwares on iOS, such as otool and GNU Debugger(GDB), which is very welcomed by iOS hackers. Shell scripts with these tools just make debugging a lot easier. People can do much more on a jailbroken iDevice than a non-jailbroken one. They can create new directories, remove files, grab network traffic and a lot more.</p>
        <p>The hardware that filesystem, or sometimes known as disk, and some other low level storages are based on is called NAND. The NAND is comprised by 6 slices. One of the slices is called FSYS, which has filesystem on it. BOOT, where the Low Level Boot loader(LLB) lies, is one of the 5 slices left. FIRM, coming from the 4 slices left, has the Apple's second stage boot loader(iBoot). The PLOG, which is the block 1 (the "1st block" is block 0) on NAND, is a powerful locker for encryption keys including DKey andEMF!. It is an effaceable stage. Since the data are all encrypted by them, no one can read it without decryption, this is the same when comes to any data. This is a very effective way because it takes less time to erase a key than the whole filesystem does.</p>
        <p>In the last two chapters of the hacking part, the author introduced how to inject objective-c's runtime with a dynamic library(dylib) and an environment variable called DYLD_INSERT_LIBRARIES. With injecting the runtime, we can change a program's methods when it is running, we can also insert our own codes into it. And there's a program called MobileSubstratewhich help us makes injections on iOS more easily. Most of the tweaks onCydia are based on it. Jailbreaking developers can use TheOS to make tweaks in a more efficient way.</p>
        <p>The hacking part takes up 8 chapters out of all the 14 chapters. The rests make up the second part, securing. It introduces the importance of a strong password, and shows the readers how to use Common Crypto library provided by Apple to make some modern encryption like AES, DES andMD5. Chapter 11 shows how to wipe secure files, records and caches. Chapter 12 introduces how to secure the runtime such as checking process trace with inline codes, how to use inline functions and how to strip programs' functions. Chapter 13 shows how to detect iDevices' jailbreaking by checking sandbox integrity, testing filesystem and checking page execution. The last chapter of this book gives some suggestions about how to make your programs more secure. This part tells us that although a series of hacking skills including jailbreaking can threaten the security of people's iDevices, but there are also many ways to protect them.</p>
        <p>While reading this book, a lot of experiments had been taken to help me have a better understanding of the meaning author intend to give. A typical one is to show how to compromise iOS via an USB protocol. It is mainly inspired by chapter 2 and 3, which talks about the basics and a little more of compromising iOS. Firstly, the system kernel was being loaded. Next, a backdoor was left in a self-made lightweight ramdisk. After that, a costumelaunchd to mount filesystem was executed. The preparation was ready after some malicious codes were run to make all the backdoor files right on the place and work properly.<p>
        <p>Now the device we made preparation on is named as device A. When something from device A, such as passwords and the address book, are needed by hackers, a PC or other jailbroken iDevices can be used to get them from it by hacking in though the backdoor we left earlier. Even the whole filesystem can be acquired this way! The backdoor can also provide a shell to hackers so that they can run scripts on it. And this method is viable on any iDevice. The procedure seems easy to accomplish, but every step during the preparation need a hardware-based(on the bootrom) vulnerability. Limara1n is one of them and can only works on Apple's A4 CPU or lower, so a device like iPod touch 4 was critical to this experiment.</p>
        <p>However, there's no hardware-based vulnerability on A5 and further version of CPUs. This is a improvement on iOS security, but it also means a new method must be created if we still need the backdoor working. After some researches and comparisons , the deb format which transplanted from Debian(a linux system) became the best choice. A deb file is used to pack the backdoor files and malicious codes together. The enhanced backdoor becomes more practical in actual hacking actions.</p>
        <p>Nevertheless, building a concealed and aggressive virus have to be able to complicate with different versions of target system. So the backdoor need to be simple and deceptive. Since c-socket is widely used in many systems to build the server-client connection, C language become the best choice of the server's source code. To have a highly simulation of clients experience, an application using Apple's CFNetwork framework was built, which has a Graphic User Interface(GUI). Rather than using a console(no GUI), it's much more easily to control the iDevice with the backdoor on another iDevice now. This total independent project was named "Ac1drain", which means a corrosion to iOS. If Ac1drain is combined with Keychain-Dumper, a program which is able to dump the keychain data including passwords frequently being used of users into a file, most sensitive data of the owner will easily be acquired by hackers with just one click.</p>
        <p>Despite the damage 2 programs above can make, one condition must be met at first, they have to operate on a jailbroken device. Obviously, jailbreaking is on the top of the list which has all the being-wanted security problems. The damage it can make comes from the compromised iOS's security model, which are often used as advantages in hacking. However, regardless of the warning comes from Apple, more and more people choose jailbreak as their first adjustment when the iDevice come into their hands.</p>
        <p>Apart from the convenience jailbreak bring to users, the convenience of jailbreak process itself also help owners make up their mind. A jailbreak could be processed in very simple way. An brilliant example is "JailbreakMe 3.0", the jailbreak to iOS 4.3.3. It is based on a website and with just one click, the Cydia app will appear on the SpringBoard(iOS' desktop), just like a normal App Store's application do without any special movements.</p>
        <p>The situation will be devastating if these vulnerabilities are used to achieve illegal purpose. The private information, especially their passwords of millions of users will be stolen. Fortunately, the main purpose of jailbreak is to bring further openness and total controlling of iDevices to users. The people who do the jailbreak work on iOS thinks this way as well. They also pay great attention to security problems as they always fix the vulnerabilities they used to make the iDevice more safe after jailbreak.</p>
        <p>The argument between hacking or not starts since the first computer worm crashed most of the computers in California. However, security will never become absolute, since no programmer can write every line of codes without making mistakes. Despite the uncountable damage virus and other attacks bring to us, what has became undeniable is that it is all the hacking actions that make our softwares and coding skill advancing instead of sticking around.</p>
        <p>The whole relationship between hacking and securing is like the paradox between peace and war somehow. Sometimes we need war to protect peace, but the action itself also break peace. And I think the author spend more ink on hacking than protecting, not because he is good at hacking, but the basic rule for a protecter is to think the way attackers do. Most of the readers will know more and pay more attention to system security instead of having fancy thought on their devices. And this, is a key to improve security anywhere.</p>
        <p>After reading this book, not only did I gain a lot on the iOS, but also did I clearly realize that hacking is for further securing. We should never intend to do harm to others, but should always fight against the harm others might do to us.</p>
    </body>
</html>