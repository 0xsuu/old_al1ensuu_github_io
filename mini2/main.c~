
#include "lpc_types.h"

#include "main.h"
#include "led.h"
#include "serialIO.h"
#include "sysTick.h"
#include "i2cIO.h"

void stage1()
{
	int addr;
	//uint8_t result = 0;
	int data = 0;
	int count_devices =0;
	serial_init();
	
	i2c_init();
	I2C_M_SETUP_Type transferCfg;
	
	printWithInt("I2C Loaded\n\r", 0);
		
	transferCfg.tx_data = &data;		
	transferCfg.tx_length =	1;	
	
	for (addr=0; addr<= 127; addr++)
	{
		printWithInt("Looping\n\r", 0);
		transferCfg.sl_addr7bit = addr;
		if (I2C_MasterTransferData((LPC_I2C_TypeDef *) LPC_I2C1, &transferCfg, I2C_TRANSFER_POLLING ))
		{
			count_devices ++;
			transferCfg.sl_addr7bit = addr;
			printWithInt("Device NO.%\n\r", count_devices);
			printWithInt("\tAddr: %\n\r", addr);
		}
	}
	printWithInt("Count: %\n\r", count_devices);
}

void stage2()
{

}

void stage3()
{

}

void stage4()
{

}

int main()
{   
    setupLEDs();
    //LEDdebug(0b1010);
    stage1();
    //stage2();
    //stage3();
    //stage4();
    
    return 0;
}
