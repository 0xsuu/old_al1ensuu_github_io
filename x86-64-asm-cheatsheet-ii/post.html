<html>
    <head>
        <title>
            (ii) syscall
        </title>
    </head>
    <body style="font-family:courier;">
        <h3>x86-64 assembly/shellcode cheatsheet</h3>
        <h4>(ii) Syscall</h4>
        <p>Invoke kernel: syscall</p><br>
        
        <p>System call number:</p>
        <p>Get syscall name: sudo dtruss ./a.out<br>
        Find syscall number: /usr/include/sys/syscall.h</p>
        <br>
        <p>How to perform a syscall:</p>
        <p>i. Phrasing syscall number<br>
        Syscall number in <big><b>rax</b></big>, format: 0x200000001, 2 shift 0x18<br>
        Shellcode:
        <div style="margin-left:20px; margin-top:-5px; margin-bottom:20px;">
        mov r8b, 0x2<br>
        shl r8, 0x18<br>
        ;mov r8b, 0x4 ;for single bit syscall number<br>
        or r8, 0x24 ;for multiple bits syscall number<br>
        mov rax, r8
        </div>
        </p>
        
        <p>ii. Forming parameters<br>
        <big><b>rdi</b></big>, <big><b>rsi</b></big>, <big><b>rdx</b></big>, <big><b>rcx</b></big>, <big><b>r8</b></big>, and <big><b>r9</b></big> are used to pass the first six parameters.<br>
        i.e. write(0x1, "Hello world!\n", 0xe)<br>
        Assembly:
        <div style="margin-left:20px; margin-top:-5px; margin-bottom:20px;">
        mov rdi, 0x1<br>
        mov rsi, msg<br>
        mov rdx 0xe<br>
        msg db "Hello world!","0xa,0
        </div>
        </p>
        
        <p>
        Technique for using strings in shellcode
        Shellcode:
        <div style="margin-left:20px; margin-top:-5px; margin-bottom:20px;">
        call execv<br>
        db "Hello World!",0xa,0<br>
        execv:<br>
        pop rdi<br>
        </div>
        Then the address of string "Hello World!\n" should be poped into rdi.
        </p>
        <br>
        <br>
        
    </body>
</html>